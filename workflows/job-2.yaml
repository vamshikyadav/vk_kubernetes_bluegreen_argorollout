- name: Update switch stage values
  run: |
    python3 <<EOF
    from ruamel.yaml import YAML
    yaml = YAML()
    yaml.preserve_quotes = True
    yaml.allow_duplicate_keys = True

    file_path = "values.yaml"
    stage_value = "${{ github.event.inputs.stage_value }}"
    set_switch1 = "${{ github.event.inputs.set_switch1 }}" == "true"
    set_switch2 = "${{ github.event.inputs.set_switch2 }}" == "true"

    with open(file_path) as f:
        data = yaml.load(f)

    if set_switch1 and 'switch1' in data:
        data['switch1']['stage'] = stage_value

    if set_switch2 and 'switch2' in data:
        data['switch2']['stage'] = stage_value

    with open(file_path, 'w') as f:
        yaml.dump(data, f)
    EOF
